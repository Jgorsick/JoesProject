DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'MVCInBuiltFeatures.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201703262125511_Email'
BEGIN
    CREATE TABLE [dbo].[AspNetRoles] (
        [Id] [nvarchar](128) NOT NULL,
        [Name] [nvarchar](256) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetRoles] PRIMARY KEY ([Id])
    )
    CREATE UNIQUE INDEX [RoleNameIndex] ON [dbo].[AspNetRoles]([Name])
    CREATE TABLE [dbo].[AspNetUserRoles] (
        [UserId] [nvarchar](128) NOT NULL,
        [RoleId] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUserRoles] PRIMARY KEY ([UserId], [RoleId])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserRoles]([UserId])
    CREATE INDEX [IX_RoleId] ON [dbo].[AspNetUserRoles]([RoleId])
    CREATE TABLE [dbo].[AspNetUsers] (
        [Id] [nvarchar](128) NOT NULL,
        [Email] [nvarchar](256),
        [EmailConfirmed] [bit] NOT NULL,
        [PasswordHash] [nvarchar](max),
        [SecurityStamp] [nvarchar](max),
        [PhoneNumber] [nvarchar](max),
        [PhoneNumberConfirmed] [bit] NOT NULL,
        [TwoFactorEnabled] [bit] NOT NULL,
        [LockoutEndDateUtc] [datetime],
        [LockoutEnabled] [bit] NOT NULL,
        [AccessFailedCount] [int] NOT NULL,
        [UserName] [nvarchar](256) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUsers] PRIMARY KEY ([Id])
    )
    CREATE UNIQUE INDEX [UserNameIndex] ON [dbo].[AspNetUsers]([UserName])
    CREATE TABLE [dbo].[AspNetUserClaims] (
        [Id] [int] NOT NULL IDENTITY,
        [UserId] [nvarchar](128) NOT NULL,
        [ClaimType] [nvarchar](max),
        [ClaimValue] [nvarchar](max),
        CONSTRAINT [PK_dbo.AspNetUserClaims] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserClaims]([UserId])
    CREATE TABLE [dbo].[AspNetUserLogins] (
        [LoginProvider] [nvarchar](128) NOT NULL,
        [ProviderKey] [nvarchar](128) NOT NULL,
        [UserId] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUserLogins] PRIMARY KEY ([LoginProvider], [ProviderKey], [UserId])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserLogins]([UserId])
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetRoles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[AspNetRoles] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserClaims] ADD CONSTRAINT [FK_dbo.AspNetUserClaims_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserLogins] ADD CONSTRAINT [FK_dbo.AspNetUserLogins_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201703262125511_Email', N'MVCInBuiltFeatures.Migrations.Configuration',  0x1F8B0800000000000400DD5C5B6FE3B8157E2FD0FF20E8A92DB2562E9DC134B0779175E26DDAC905E3CCA06F035AA21D75244A2B52D9048BFD657DE84FEA5FE8A144C9122FBAD88AED2C16588C45F23B87871FC9C3C3C3FCEF3FFF1DFFF01C06D6134EA81F91897D323AB62D4CDCC8F3C96A62A76CF9DD07FB87EFFFF887F195173E5B5F8A7A67BC1EB42474623F32169F3B0E751F7188E828F4DD24A2D1928DDC2874901739A7C7C77F734E4E1C0C10366059D6F8534A981FE2EC07FC9C46C4C5314B5170137938A0E23B94CC3354EB168598C6C8C513FB1F11A6F749F46FECB2515EDBB62E021F8126731C2C6D0B111231C440CFF3CF14CF591291D53C860F2878788931D45BA28062A1FFF9BA7AD7AE1C9FF2AE38EB8605949B5216853D014FCE846D1CB9F94616B64BDB81F5AEC0CAEC85F73AB3E0C4BEF670F6E9531480016481E7D320E19527F64D29E282C6B7988D8A86A31C729600DC2F51F26D54453CB23AB73B2AB9743A3AE6FF1D59D3346069822704A72C41C191759F2E02DFFD277E7988BE6132393B592CCF3EBC7B8FBCB3F77FC567EFAA3D85BE42BDDA07F80434897102BAE165D97FDB72EAED1CB961D9ACD226B70A7009A6856DDDA0E78F98ACD8234C98D30FB635F39FB1577C11E4FA4C7C9845D0882529FCBC4D83002D025C963B8D32F9FF1BA49EBE7B3F88D45BF4E4AFB2A197E4C3C449605E7DC241564A1FFD389F5EB5F1FE2AAACD9228E4BFEBFCCA4BBFCEA3347179672263950794AC30AB6B3776D6E4ED44690E353CAD0BD4C3A736D754A5B7B62AEFD02633A110B1EBD950E8FBBA723B33EE228E61F0326A718B34114EDDAC46526B20D697E935F931F50336C388D384AE1974D29541047AF67B5E10AF42E40703AC881DA48033B2F4931097BDFC3102FE21D25BE77B44292C08DEDF117D6C501DFE3980EA73ECA609F074CE5018BFBAB4FBC788E0DB345C70FAEF4ED66043F3F04B34432E8B922BC25B6D8DF73172BF4529BB22DE2562F833730B40FEF3C10FBB030CA2CE85EB624A674066EC4D23F0B50BC06BC2CE4E7BC3F1756ADF1EC934407EA87749A415F56B5175ED96E86B28AE89A19ACE3D6952F563B4F24937558BAA6655F31AADAA8A6A7D55E560DD341535CD8A66155AF5CC6B0DE6F0652334BCC797C11EBECBB7DDE66D5A0B2A669CC30A897FC20427B08C79F788319C90F508745937F6E12C64C3C785BEFADE9449FA82827468511BCD866C11187E3664B0873F1B3235E1F393EF71AFA4C339A8A80CF09DEAEB8F58ED734ED26CD7D3A1D6CD5D0BDFCD1A609A2E179446AE9FCD024D044CC42FEAFA830F67B50733F2DEC80111E81810DDE75B1E7C81BED932A9EEC8250E30C3D6859B4708A788BAC853CD081DF27A2856ECA81AC5D68191BA727F516402D371C21B217E08A230537DC2D469E113D78F51D06A25A965C72D8CF7BD9421975CE218132EB0D5125D84EBE3205C81528E34286D161A3B15C63513D1E0B59AC6BCCD855D8FBB129ED809275B7C67032F85FFF62AC46CB6D80EC8D96C922E0A18637AFB20A838AB7425807C703934824A27260341854BB51382D62DB60782D64DF2E6089A1F51BB8EBF745E3D347AD60FCABBDFD61BCDB5076ED6EC7160D4CC7D4F68C3A0054E547A5E2E78217E669AC319E829CE6754B8BA324538F81CB37AC866EDEF6AFD50A71944265113E09A682DA0E23650015226540FE58A585EA376C28BE8015BC4DD1A61C5DA2FC15638A062576F452B15CD77A732393B9D3ECA9E956C5048DEE9B050C1D110425EBCEA1DEF6014535C56354C175FB88F375CE998188C0603B578AE0623159D19DC4A0535DBADA473C8FAB8645B5949729F0C562A3A33B8950447DB8DA4710A7AB8055B99A8BE850F34D98A4847B9DB946563274F96121FC68E21AB6A7C83E2D827AB4A9695F862CDF314ABE977F3FEB947618EE1B8549382546A5B4A62518256582A05D1A0E9CC4F28BB440C2D108FF34CBD50A9A6DD5B0DCB7F21B2BA7DAA8358EC03456DFEEFBC85E60EBFB6D7AACE88C098410F43EED1646174CDF8EB9B5B3CEB0D0528D144EEA7519086C4EC60995BE7F777D5F6F9171561EC48FA2B0E94622DC5CDAD9BBED3C0A89362A0412AFD97CD07CA0C613277E17D560D6EF248CD284580AA8A620A5AED6DE04C8E4CAFC1927DC4FE63D58AF03AF34A24A65401C4A79E1895DC0605AC52D61DB59E7E52C5AC97744794724CAA9052510F2DAB99243525AB051BE1192CAAAFD15D829A3B5245574BBB236BB248AAD09AE20DB0353ACB65DD5135892655604D7177EC75D689BC881EF0CE653CB96CBC75E587DBEDF62E03C6EBAC88C36C7D953BFC2A50E5734F2C714BAF8089EF07C926E3096F6336E5318DEDD864C030AF3CB5DBEFFAC2D378656FC6AC5D69D716F7A62B7D335E3FCEBE2A3394039E5CA5945E1EF4A403DD581CAEDADFD228A7ADBC8A6D1566848DFD85321C8E7885D1FCE7601AF8982FE345851B44FC25A62C4FE3B04F8F4F4EA5E73887F334C6A1D40B348753D3FB98FA98ED20238B3CA1C47D44899A1FB1C5F39135A8127ABE261E7E9ED8BF66ADCEB32806FF57F6F9C8BAA69F89FF730A050F498AADDFD47CCF61D2E99B0F5907FAF8A1BB55AFFFF5356F7A64DD253063CEAD63C9969B8C70FD49442F6DF2A65B68B3F14389B73BA16ACF0FB4A8D284D8FCB5C1C26783BC3428B4FC53889EFFDC5735ED6B82AD10352F0686C21BC484A617019B60195F0378F09365AF01FA7556FF3A6013D58C2F037CD21F4C7E17D07D192A5AEE71ABD19C8976B12465766ECDABDE2AC972DF7B93927EBDD5445753AC7BC06D9146BD0133DE5806F260BBA326C17830EC7D52FBD5B38A0F2591789DE2B1DFFCE15DA60C375C0BFDAE32850F20B74D93ABB3FF7CE05D73CD14C73DF0A4CA7E59BF07463691C1B5FFDCDE5D93CD14E63D70B2F5CAE03D30AEED6BFFDC33D33A6FA17BCFC755538B0CF731BA58705BBE6D1E388713FE220212E41E65FE4C529FE0D5949CDA22705DC52CD49C59260B56268E2257A9D12CB65F5FC586DFD85951A759AC211FB349B658FF1B658B3ACDB20D598EFBC814D6E619EAB2B75BD6B1A624A8B794195CEB494B227A9BCFDA78B9FE96128107314A6DF618EE88DF4EDEEF20261972EAF4C8F355AF7B61EFACFC8145D8BFA9BF5A43F03FB748B05BDB35CB3AD76419159BB7A45151458AD0DC60863CD8522F12E62F91CBA098C798B377DE59DC8EDF742CB0774DEE5216A70CBA8CC345500B787127A0497E96CC5CD7797C17677FB264882E809A3E8FCDDF657F87CB2BF59E6962420608EE5D88882E1F4BC623BBAB9712E936221D8184F94AA7E80187710060F48ECCD113DE4437A0DF47BC42EECB3A026802691F88BAD9C7973E5A2528A40263DD1E7E0287BDF0F9FBFF03B991652567540000 , N'6.1.3-40302')
END

